<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/2.11.0/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/2.11.0/tabulator.min.js"></script>

<script>
$( function() {
  var dFormat = "dd/mm/yy",
    from = $( "#date-from" )
      .datepicker({
        defaultDate: "+1w",
        changeMonth: true,
        numberOfMonths: 1,
        dateFormat: dFormat
      })
      .on( "change", function() {
        to.datepicker( "option", "minDate", getDate( this ) );
      }),
    to = $( "#date-to" ).datepicker({
      defaultDate: "+1w",
      changeMonth: true,
      numberOfMonths: 1,
      dateFormat: dFormat
    })
    .on( "change", function() {
      from.datepicker( "option", "maxDate", getDate( this ) );
    });

  function getDate( element ) {
    var date;
    try {
      date = $.datepicker.parseDate( dFormat, element.value );
    } catch( error ) {
      date = null;
    }

    return date;
  }
} );
</script>

</head>



<body>
  Observation type:
  <select type="text" id="obstype-search">
    <option value="">any</option>
    <option value="calibrator">calibrator</option>
    <option value="elnod">elnod</option>
    <option value="CenA">CenA</option>
    <option value="RCW38">RCW38</option>
    <option value="saturn">saturn</option>
  </select>

  <br>

  <label for="date-from">Start date:</label>
  <input type="text" id="date-from" name="date-from">
  <label for="date-to">End date:</label>
  <input type="text" id="date-to" name="date-to">

  <br>

  <label for="obsid-from">Obs ID range: from</label>
  <input type="number" id="obsid-from" name="obsid-from">
  <label for="obsid-to">to</label>
  <input type="number" id="obsid-to" name="obsid-to">

  <br>

  <button onclick="search()">Search</button>

  <div id="example-table"></div>

<script>
  //create Tabulator on DOM element with id "example-table"
  $("#example-table").tabulator({
    pagination:"remote",  // use this for normal pagination
    // progressiveRender:"remote",  // progressive rendering with AJAX requests; cool!!
    ajaxURL:"/page", //set the ajax URL
    ajaxParams: {source: $("#obstype-search").val(),
                 date:  {min: $("#date-from").val(),
                         max: $("#date-to").val()},
                 observation:    {min: $("#obsid-from").val(),
                         max: $("#obsid-to").val()}},
    ajaxConfig:'GET',
    paginationSize:20,
    index:"_id",
    height:"320px", // set height of table (optional)
    fitColumns:true, //fit columns to width of table (optional)
    columns:[ //Define Table Columns
      {title:"Observation ID", field:"observation", width:140, sorter:"number"},
      {title:"Source", field:"source", width:150},
      {title:"Path on scott", field:"path"},
      {title:"Fullrate status", field:"status_fullrate", width:150},
      {title:"Downsampled status", field:"status_downsampled", width:150},
      {title:"Fullrate transfer", field:"transfer_fullrate", formatter:"tickCross", width:150},
      {title:"Downsampled transfer", field:"transfer_downsampled", formatter:"tickCross", width:150},
      {title:"Date", field:"date", sorter:"date", width:80},
      {title:"Time", field:"time", sorter:"time", width:80}
    ],
    rowClick:function(e, id, obsdata, row){ //trigger an alert message when the row is clicked
      console.log(obsdata)
      $.post("series", obsdata, function(data, status) {
        var w = window.open('about:blank', 'windowname');
        w.document.write(data);
        w.document.close();
      });
    },
  });

  function search() {
    // package up the search fields into a json to send to server
    querydata = {page:1,
                 size:20,
                 source: $("#obstype-search").val(),
                 date:  {min: $("#date-from").val(),
                         max: $("#date-to").val()},
                 observation:    {min: $("#obsid-from").val(),
                         max: $("#obsid-to").val()}}
    $("#example-table").tabulator("setData", "/page", querydata);
  }

</script>

</body>
</html>
