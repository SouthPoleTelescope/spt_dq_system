<html>
<head>
<link rel="stylesheet" href="css/photoswipe.css">
<link rel="stylesheet" href="css/default-skin/default-skin.css">
<script src="js/photoswipe.min.js"></script>
<script src="js/photoswipe-ui-default.min.js"></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/TweenMax.min.js"></script>-->
<script src="js/jquery-1.12.4.js"></script>
<script src="js/jquery-ui.js"></script>

</head>
<body>
<style>
/* default styles */
body {
  background: #3c3e40;
  color: white;
  overflow-x: hidden;
  font-family: Arial, sans-serif;
}
/* header */
#content {
  position: relative;
  z-index: 13;
  color: white;
  text-align: center;
}
/* spinning loader */
#loader-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 11;
}
/* outside */
#loader {
  display: block;
  position: relative;
  left: 47px;
  top: -35px;
  width: 150px;
  height: 150px;
  margin: -75px 0 0 -75px;
  border-radius: 50%;
  border: 3px solid transparent;
  border-top-color: #009ddc;
  -webkit-animation: spin 2s linear infinite; /* Chrome, Opera 15+, Safari 5+ */
  animation: spin 2s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */
}
/* middle */
#loader:before {
  content: "";
  position: absolute;
  top: 5px;
  left: 5px;
  right: 5px;
  bottom: 5px;
  border-radius: 50%;
  border: 3px solid transparent;
  border-top-color: #ff3c38;
  -webkit-animation: spin 3s linear infinite; /* Chrome, Opera 15+, Safari 5+ */
  animation: spin 3s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */
}
/* inside */
#loader:after {
  content: "";
  position: absolute;
  top: 15px;
  left: 15px;
  right: 15px;
  bottom: 15px;
  border-radius: 50%;
  border: 3px solid transparent;
  border-top-color: #ff8c42;
  -webkit-animation: spin 1.5s linear infinite; /* Chrome, Opera 15+, Safari 5+ */
  animation: spin 1.5s linear infinite; /* Chrome, Firefox 16+, IE 10+, Opera */
}
/* spinning animation frames */
@-webkit-keyframes spin {
  0%   {
    -webkit-transform: rotate(0deg);  /* Chrome, Opera 15+, Safari 3.1+ */
    -ms-transform: rotate(0deg);  /* IE 9 */
    transform: rotate(0deg);  /* Firefox 16+, IE 10+, Opera */
  }
  100% {
    -webkit-transform: rotate(360deg);  /* Chrome, Opera 15+, Safari 3.1+ */
    -ms-transform: rotate(360deg);  /* IE 9 */
    transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera */
  }
}
@keyframes spin {
  0%   {
    -webkit-transform: rotate(0deg);  /* Chrome, Opera 15+, Safari 3.1+ */
    -ms-transform: rotate(0deg);  /* IE 9 */
    transform: rotate(0deg);  /* Firefox 16+, IE 10+, Opera */
  }
  100% {
    -webkit-transform: rotate(360deg);  /* Chrome, Opera 15+, Safari 3.1+ */
    -ms-transform: rotate(360deg);  /* IE 9 */
    transform: rotate(360deg);  /* Firefox 16+, IE 10+, Opera */
  }
}
/* loading bar */
#preloader {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  background-color: #212121;
  color: #ffffff;
}
/* text */
#preloader .txt {
  position: absolute;
  top: 50%;
  left: 50%;
  -webkit-transform: translate(-50%, -50%);
  -ms-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
}
/* percentage */
#preloader .txt-perc {
  font-size: 35px;
  opacity: 1;
  margin: 0 0 6px 0;
  max-width: 400px;
  text-align: center;
}
/* progress bar container */
#preloader .progress {
  width: 100px;
  height: 3px;
  background-color: rgba(255, 255, 255, 0.2);
  margin: 0 auto 15px auto;
}
/* progress bar */
#preloader .progress span {
  display: block;
  width: 0;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.8);
}

/* image container */
#img_div {
  width: 100%;
  height: 100%;
  position: absolute;
  text-align: center;
  display: none;
}

/* image style */
img {
  width: 400;
  height: 300;
  position: relative;
  z-index: 12;
  cursor: pointer;
  padding: 5px;
}

th, td {
  text-align: left;
}
td {
  height: 75px;
}
</style>

<!-- loading elements -->
<div id="content">
  <h2 id="header">Making plots...</h2>
</div>
<div id="preloader">
  <div class="txt">
  <p class="txt-perc">0%</p>
  <div class="progress"><span></span></div>
  <div id="loader"></div>
  </div>
</div>

<div>
  <table id="table" style="width:100%; display:none;">
    <tr>
      <th>Messages</th>
      <th>Error Details</th>
    </tr>
    <tr>
      <td><textarea id="dialog" readonly style="width:100%; height:100%; resize:none;"></textarea></td>
      <td><textarea id="err_dialog" readonly style="width:100%; height:100%; resize:none;"></textarea></td>
    </tr>
  </table>
</div>

<script>
// functions to append messages to the specified text area
function show(message) {
  var textarea = document.getElementById("dialog");
  textarea.value += message + "\n\n";
  document.getElementById("table").style["display"] = "table";
}
function show_err(message) {
  var textarea = document.getElementById("err_dialog");
  textarea.value += message + "\n\n";
  document.getElementById("table").style["display"] = "table";
}
</script>

<!--<script>
// the progress bar is made using GSAP tween timeline

// load_progress is called whenever a new plot is made and updates the progress
function load_progress() {
  loaded_count++;
  loading_progress = loaded_count / images_to_load;
  // tell the progress bar to update
  TweenLite.to(progress_tl, 0.1, {progress:loading_progress, ease:Linear.easeNone});
}

// progress timeline
var progress_tl = new TimelineMax({
  paused: true,
  onUpdate: progress_update,
});

// tween the progress bar width
progress_tl.to($('.progress span'), 0.1, {width:100, ease:Linear.easeNone});

// as the progress bar width updates and grows we put the percentage
// loaded in the screen
function progress_update() {
  // the percentage loaded based on the tween's progress
  loading_progress = Math.round(progress_tl.progress() * 100);
  // we put the percentage in the screen
  $(".txt-perc").text(loading_progress + '%');
}
</script>-->

<!-- image container -->
<div id=img_div></div>

<!-- The rest of this page is devoted to the image viewer -->
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<script>
// items is a list of many images' characteristics passed by the main page
// for use by photoswipe and to get the image source
var items;

// load images into the webpage and disable the loading screen when done
function start_image(images) {
  items = images;
  for (var i = 0; i < items.length; i++) {
    var img = new Image();
    img.addEventListener('click', function(){open_viewer(this.index);});
    img.src = items[i].src;
    img.index = i;
    $('#img_div').append(img);
  }
  $('#preloader').css('display', 'none');
  $('#header').text('Plot Display');
  $('#img_div').css('display', 'inline');
}

/* open photoswipe image viewer at given index */
function open_viewer(index) {
  var pswpElement = document.querySelectorAll('.pswp')[0];
  var options = {
    index: index,
    closeOnScroll: false,
    closeOnVerticalDrag: false,
    zoomEl: true,
    clickToCloseNonZoomable: false,
    shareButtons: [
      {id:'download', label:'Download image', url:'{{raw_image_url}}', download:true}
     ],
    closeElClasses: [],
  };
  // Initializes and opens PhotoSwipe
  var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
  gallery.listen('gettingData', function(index, item) {
    if (item.w < 1 || item.h < 1) { // unknown size
      var img = new Image(); 
      img.onload = function() { // will get size after load
        item.w = this.width; // set image width
        item.h = this.height; // set image height
        gallery.invalidateCurrItems(); // reinit Items
        gallery.updateSize(true); // reinit Items
      }
      img.src = item.src; // download image
    }
  });
  gallery.init();
}

</script>

</body>
</html>
